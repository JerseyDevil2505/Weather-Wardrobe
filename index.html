<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Wardrobe - Smart Clothing for Any Weather</title>
    <meta name="description" content="Get personalized clothing recommendations based on current weather conditions">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3B82F6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Weather Wardrobe">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath d='M24 4 C24 4, 26 4, 26 6 C26 8, 24 8, 24 8' stroke='%233B82F6' stroke-width='2' fill='none'/%3E%3Cpath d='M12 16 L24 8 L36 16 L42 14 L42 18 L36 20 L12 20 L6 18 L6 14 Z' fill='%233B82F6'/%3E%3C/svg%3E">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React from a more reliable CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
    
    <!-- Loading fallback styles -->
    <style>
        .loading-fallback {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-family: Arial, sans-serif;
            flex-direction: column;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root">
        <!-- Loading fallback -->
        <div class="loading-fallback">
            <div class="spinner"></div>
            <h2>Loading Weather Wardrobe...</h2>
            <p>If this takes too long, please refresh the page</p>
        </div>
    </div>

    <script type="text/babel">
        // Icon components (simplified inline)
        const CloudIcon = () => (
            <svg className="w-12 h-12 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
            </svg>
        );

        const SunIcon = () => (
            <svg className="w-12 h-12 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
        );

        const CloudRainIcon = () => (
            <svg className="w-12 h-12 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M8 19v2m8-2v2m-4-3v2m-4-5v2"/>
            </svg>
        );

        const MapPinIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
        );

        const EditIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
            </svg>
        );

        const UserIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
        );

        const SettingsIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
        );

        const XIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        );

        const WeatherClothingApp = () => {
          const [location, setLocation] = React.useState('');
          const [savedLocation, setSavedLocation] = React.useState('');
          const [isEditingLocation, setIsEditingLocation] = React.useState(false);
          const [weather, setWeather] = React.useState(null);
          const [loading, setLoading] = React.useState(false);
          const [error, setError] = React.useState('');
          const [showProfile, setShowProfile] = React.useState(false);
          
          // User preference state
          const [userProfile, setUserProfile] = React.useState({
            name: '',
            temperaturePreference: 'average',
            activityLevel: 'moderate',
            clothingStyle: 'casual',
            hasLearned: false,
            feedbackCount: 0
          });

          // Load user profile and saved location from storage when component mounts
          React.useEffect(() => {
            try {
              const savedProfile = JSON.parse(localStorage.getItem('weatherWardrobeProfile') || '{}');
              if (Object.keys(savedProfile).length > 0) {
                setUserProfile(prev => ({ ...prev, ...savedProfile }));
              }
              
              const savedLoc = localStorage.getItem('weatherWardrobeLocation');
              if (savedLoc) {
                setSavedLocation(savedLoc);
                setLocation(savedLoc);
              }
            } catch (e) {
              console.log('Storage not available, using memory only');
            }
          }, []);

          // Save profile to storage whenever it changes
          React.useEffect(() => {
            try {
              if (userProfile.name) {
                localStorage.setItem('weatherWardrobeProfile', JSON.stringify(userProfile));
              }
            } catch (e) {
              console.log('Cannot save profile to storage');
            }
          }, [userProfile]);

          // Save location to storage whenever it changes
          React.useEffect(() => {
            try {
              if (savedLocation) {
                localStorage.setItem('weatherWardrobeLocation', savedLocation);
              }
            } catch (e) {
              console.log('Cannot save location to storage');
            }
          }, [savedLocation]);

          const getWeatherIcon = (condition) => {
            const lowerCondition = condition.toLowerCase();
            if (lowerCondition.includes('rain') || lowerCondition.includes('drizzle')) {
              return React.createElement(CloudRainIcon);
            } else if (lowerCondition.includes('cloud')) {
              return React.createElement(CloudIcon);
            } else {
              return React.createElement(SunIcon);
            }
          };

          const getClothingRecommendation = (temp, condition) => {
            const lowerCondition = condition.toLowerCase();
            let baseTemp = temp;
            
            // Adjust temperature based on user preferences
            if (userProfile.temperaturePreference === 'runs-hot') {
              baseTemp += 10;
            } else if (userProfile.temperaturePreference === 'runs-cold') {
              baseTemp -= 10;
            }
            
            // Adjust for activity level
            if (userProfile.activityLevel === 'high') {
              baseTemp += 5;
            } else if (userProfile.activityLevel === 'low') {
              baseTemp -= 5;
            }
            
            let recommendation = '';
            let personalNote = '';
            
            if (userProfile.hasLearned && userProfile.name) {
              personalNote = `Hi ${userProfile.name}! Based on your preferences: `;
            }
            
            if (baseTemp >= 80) {
              if (userProfile.clothingStyle === 'minimal') {
                recommendation = "It's hot! Tank top and shorts are perfect. Footwear: sandals or breathable sneakers.";
              } else {
                recommendation = "It's hot today! Light t-shirt and shorts or a sundress. Footwear: sandals, flip-flops, or breathable sneakers. Don't forget sunscreen!";
              }
            } else if (baseTemp >= 70) {
              recommendation = "Perfect weather! T-shirt with jeans, shorts, or a light dress. Footwear: sneakers, loafers, or casual shoes work great.";
            } else if (baseTemp >= 60) {
              if (userProfile.clothingStyle === 'layered') {
                recommendation = "Mild weather - perfect for layering! Light sweater over a t-shirt with pants, or a cardigan. Footwear: comfortable sneakers or casual shoes.";
              } else {
                recommendation = "The temperature is mild today. Long pants with a light sweater over a t-shirt, or a light jacket. Footwear: comfortable sneakers or casual shoes.";
              }
            } else if (baseTemp >= 50) {
              recommendation = "Getting cooler! Long pants with a medium-weight jacket, hoodie, or sweater. Footwear: closed-toe shoes or light boots.";
            } else if (baseTemp >= 40) {
              recommendation = "It's chilly! Warm jacket with layers, long pants, and consider a scarf. Footwear: boots or warm shoes with socks.";
            } else if (baseTemp >= 30) {
              recommendation = "Cold outside! Heavy coat, warm layers, gloves, and hat. Footwear: insulated boots or winter shoes.";
            } else {
              recommendation = "Freezing! Full winter gear - heavy coat, multiple layers, gloves, hat, and scarf. Footwear: waterproof winter boots with good insulation.";
            }

            // Add weather-specific additions
            if (lowerCondition.includes('rain') || lowerCondition.includes('drizzle')) {
              recommendation += " Weather alert: It's rainy - wear waterproof shoes or rain boots, and don't forget an umbrella!";
            }
            if (lowerCondition.includes('snow')) {
              recommendation += " Snow conditions: Definitely wear waterproof winter boots with good traction to avoid slipping!";
            }
            if (lowerCondition.includes('wind')) {
              recommendation += " Windy conditions: Consider a windbreaker and make sure your shoes are secure.";
            }

            // Add preference explanation
            if (userProfile.temperaturePreference === 'runs-hot') {
              recommendation += " (Adjusted lighter since you tend to run warm)";
            } else if (userProfile.temperaturePreference === 'runs-cold') {
              recommendation += " (Adjusted warmer since you tend to feel cold)";
            }

            return personalNote + recommendation;
          };

          const fetchWeather = async (locationToUse = null) => {
            const searchLocation = locationToUse || location;
            
            if (!searchLocation.trim()) {
              setError('Please enter a location');
              return;
            }

            setLoading(true);
            setError('');

            try {
              const API_KEY = 'cba7b76137ba4b9c294932d35ee4da68';
              const response = await fetch(
                `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(searchLocation)}&appid=${API_KEY}&units=imperial`
              );
              
              const data = await response.json();
              
              if (response.ok) {
                const weatherData = {
                  location: `${data.name}, ${data.sys.country}`,
                  temperature: Math.round(data.main.temp),
                  condition: data.weather[0].main,
                  humidity: data.main.humidity,
                  windSpeed: Math.round(data.wind?.speed || 0),
                  feelsLike: Math.round(data.main.feels_like)
                };
                
                setWeather(weatherData);
                
                if (!savedLocation || savedLocation !== searchLocation) {
                  setSavedLocation(searchLocation);
                }
                setIsEditingLocation(false);
                
              } else {
                setError(data.message || 'Location not found. Please try again with a different location.');
              }
              
            } catch (err) {
              console.log('API call failed, using demo data:', err);
              
              const demoWeather = {
                location: searchLocation,
                temperature: Math.floor(Math.random() * 50) + 30,
                condition: ['Clear', 'Clouds', 'Rain', 'Snow'][Math.floor(Math.random() * 4)],
                humidity: Math.floor(Math.random() * 40) + 40,
                windSpeed: Math.floor(Math.random() * 15) + 2,
                feelsLike: Math.floor(Math.random() * 50) + 30
              };
              
              setWeather(demoWeather);
              
              if (!savedLocation || savedLocation !== searchLocation) {
                setSavedLocation(searchLocation);
              }
              setIsEditingLocation(false);
              
              setError('Note: Using demo weather data. In a real deployment, this would show live weather from OpenWeatherMap API.');
            } finally {
              setLoading(false);
            }
          };

          const updateUserProfile = (updates) => {
            setUserProfile(prev => ({ ...prev, ...updates }));
          };

          const markAsLearned = () => {
            setUserProfile(prev => ({ 
              ...prev, 
              hasLearned: true, 
              feedbackCount: prev.feedbackCount + 1 
            }));
          };

          return React.createElement(
            'div',
            { className: 'min-h-screen bg-gradient-to-br from-blue-400 via-blue-500 to-blue-600 p-4' },
            React.createElement(
              'div',
              { className: 'max-w-md mx-auto' },
              React.createElement(
                'div',
                { className: 'bg-white rounded-3xl shadow-2xl overflow-hidden' },
                
                // Header
                React.createElement(
                  'div',
                  { className: 'bg-gradient-to-r from-blue-600 to-blue-700 p-6 text-white relative overflow-hidden' },
                  React.createElement(
                    'div',
                    { className: 'absolute inset-0 opacity-10' },
                    React.createElement('div', { className: 'absolute top-2 left-4 w-8 h-8 border-2 border-white rounded-full' }),
                    React.createElement('div', { className: 'absolute top-8 right-12 w-4 h-4 bg-white rounded-full' }),
                    React.createElement('div', { className: 'absolute bottom-4 left-12 w-6 h-6 border border-white rounded-full' }),
                    React.createElement('div', { className: 'absolute bottom-8 right-6 w-3 h-3 bg-white rounded-full' })
                  ),
                  React.createElement(
                    'div',
                    { className: 'flex items-center justify-between relative' },
                    React.createElement(
                      'div',
                      { className: 'flex items-center space-x-3' },
                      React.createElement(
                        'div',
                        { className: 'relative' },
                        React.createElement(
                          'svg',
                          { className: 'w-12 h-12', viewBox: '0 0 48 48', fill: 'none' },
                          React.createElement('path', { d: 'M24 4 C24 4, 26 4, 26 6 C26 8, 24 8, 24 8', stroke: 'white', strokeWidth: '2', strokeLinecap: 'round', fill: 'none' }),
                          React.createElement('path', { d: 'M12 16 L24 8 L36 16 L42 14 L42 18 L36 20 L12 20 L6 18 L6 14 Z', fill: 'white', fillOpacity: '0.9' }),
                          React.createElement('path', { d: 'M18 20 L18 22 L16 24 L16 40 L32 40 L32 24 L30 22 L30 20', stroke: 'white', strokeWidth: '2', fill: 'rgba(255,255,255,0.1)', strokeLinecap: 'round', strokeLinejoin: 'round' }),
                          React.createElement('path', { d: 'M16 24 L12 26 L12 32 L16 30', stroke: 'white', strokeWidth: '2', fill: 'none', strokeLinecap: 'round' }),
                          React.createElement('path', { d: 'M32 24 L36 26 L36 32 L32 30', stroke: 'white', strokeWidth: '2', fill: 'none', strokeLinecap: 'round' })
                        ),
                        React.createElement(
                          'div',
                          { className: 'absolute -top-1 -right-1 bg-white bg-opacity-20 rounded-full p-1' },
                          React.createElement(CloudIcon)
                        )
                      ),
                      React.createElement(
                        'div',
                        null,
                        React.createElement('h1', { className: 'text-2xl font-bold tracking-wide' }, 'Weather Wardrobe'),
                        React.createElement('p', { className: 'text-blue-100 text-sm' }, 
                          userProfile.name ? `Hello, ${userProfile.name}!` : 'Smart clothing for any weather'
                        )
                      )
                    ),
                    React.createElement(
                      'button',
                      { 
                        onClick: () => setShowProfile(!showProfile),
                        className: 'p-3 bg-white bg-opacity-20 rounded-xl hover:bg-opacity-30 transition-all duration-200 backdrop-blur-sm'
                      },
                      userProfile.name ? React.createElement(UserIcon) : React.createElement(SettingsIcon)
                    )
                  )
                ),

                // Profile Setup
                showProfile && React.createElement(
                  'div',
                  { className: 'p-6 border-b border-gray-200 bg-gray-50' },
                  React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, 'Personalize Your Experience'),
                  React.createElement(
                    'div',
                    { className: 'space-y-4' },
                    React.createElement(
                      'div',
                      null,
                      React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Your Name'),
                      React.createElement('input', {
                        type: 'text',
                        value: userProfile.name,
                        onChange: (e) => updateUserProfile({ name: e.target.value }),
                        placeholder: 'Enter your name',
                        className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent'
                      })
                    ),

                    React.createElement(
                      'div',
                      null,
                      React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Temperature Preference'),
                      React.createElement(
                        'div',
                        { className: 'grid grid-cols-3 gap-2' },
                        [
                          { value: 'runs-cold', label: 'I Run Cold', desc: 'Need warmer clothes' },
                          { value: 'average', label: 'Average', desc: 'Standard comfort' },
                          { value: 'runs-hot', label: 'I Run Hot', desc: 'Need lighter clothes' }
                        ].map(option => 
                          React.createElement(
                            'button',
                            {
                              key: option.value,
                              onClick: () => updateUserProfile({ temperaturePreference: option.value }),
                              className: `p-3 text-xs border rounded-lg transition-all ${
                                userProfile.temperaturePreference === option.value
                                  ? 'bg-blue-100 border-blue-500 text-blue-700'
                                  : 'bg-white border-gray-300 text-gray-700 hover:border-blue-300'
                              }`
                            },
                            React.createElement('div', { className: 'font-medium' }, option.label),
                            React.createElement('div', { className: 'text-gray-500' }, option.desc)
                          )
                        )
                      )
                    ),

                    React.createElement(
                      'button',
                      {
                        onClick: () => {
                          markAsLearned();
                          setShowProfile(false);
                        },
                        className: 'w-full mt-4 bg-gradient-to-r from-green-600 to-green-700 text-white py-2 px-4 rounded-lg font-medium hover:from-green-700 hover:to-green-800 transition-all'
                      },
                      'Save Preferences'
                    )
                  )
                ),

                // Location Input Section
                React.createElement(
                  'div',
                  { className: 'p-6' },
                  savedLocation && !isEditingLocation ? 
                    React.createElement(
                      'div',
                      { className: 'mb-6' },
                      React.createElement(
                        'div',
                        { className: 'flex items-center justify-between bg-blue-50 rounded-xl p-4 border border-blue-200' },
                        React.createElement(
                          'div',
                          { className: 'flex items-center space-x-3' },
                          React.createElement(MapPinIcon),
                          React.createElement(
                            'div',
                            null,
                            React.createElement('p', { className: 'text-sm text-blue-600 font-medium' }, 'Your Location'),
                            React.createElement('p', { className: 'text-blue-800 font-semibold' }, savedLocation)
                          )
                        ),
                        React.createElement(
                          'button',
                          {
                            onClick: () => setIsEditingLocation(true),
                            className: 'p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors',
                            title: 'Edit location'
                          },
                          React.createElement(EditIcon)
                        )
                      ),
                      React.createElement(
                        'button',
                        {
                          onClick: () => fetchWeather(savedLocation),
                          disabled: loading,
                          className: 'w-full mt-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 px-6 rounded-xl font-semibold hover:from-blue-700 hover:to-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200'
                        },
                        loading ? 'Getting Weather...' : 'Get Today\'s Clothing Advice'
                      )
                    ) :
                    React.createElement(
                      'div',
                      { className: 'mb-6' },
                      React.createElement(
                        'div',
                        { className: 'relative' },
                        React.createElement(MapPinIcon, { className: 'absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5' }),
                        React.createElement('input', {
                          type: 'text',
                          value: location,
                          onChange: (e) => setLocation(e.target.value),
                          placeholder: savedLocation ? "Enter new location" : "Enter city, state, or zip code",
                          className: 'w-full pl-10 pr-16 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none',
                          onKeyPress: (e) => e.key === 'Enter' && fetchWeather()
                        })
                      ),
                      React.createElement(
                        'button',
                        {
                          onClick: fetchWeather,
                          disabled: loading,
                          className: 'w-full mt-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 px-6 rounded-xl font-semibold hover:from-blue-700 hover:to-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200'
                        },
                        loading ? 'Getting Weather...' : (savedLocation ? 'Update Location' : 'Get Clothing Advice')
                      )
                    ),

                  // Error Display
                  error && React.createElement(
                    'div',
                    { className: 'bg-red-50 border border-red-200 rounded-xl p-4 mb-6' },
                    React.createElement('p', { className: 'text-red-700 text-sm' }, error)
                  ),

                  // Weather Results
                  weather && React.createElement(
                    'div',
                    { className: 'space-y-6' },
                    React.createElement(
                      'div',
                      { className: 'bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6' },
                      React.createElement(
                        'div',
                        { className: 'flex items-center justify-between mb-4' },
                        React.createElement(
                          'div',
                          null,
                          React.createElement('h2', { className: 'text-xl font-semibold text-gray-800' }, weather.location),
                          React.createElement('p', { className: 'text-3xl font-bold text-blue-600' }, weather.temperature + '°F'),
                          React.createElement('p', { className: 'text-gray-600' }, weather.condition)
                        ),
