<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather Wardrobe - Smart Clothing for Any Weather</title>
    <meta
      name="description"
      content="Get personalized clothing recommendations based on current weather conditions"
    />

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3B82F6" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Weather Wardrobe" />

    <!-- Updated Favicon -->
    <link rel="icon" type="image/png" href="assets/weather_wardrobe_icon.png" />
    <link rel="apple-touch-icon" href="assets/weather_wardrobe_icon.png" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      .weather-icon {
        width: 48px;
        height: 48px;
      }
      .hidden {
        display: none;
      }
      .spinner {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top: 2px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .app-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body
    class="min-h-screen bg-gradient-to-br from-blue-400 via-blue-500 to-blue-600 p-4"
  >
    <div class="max-w-md mx-auto">
      <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
        <!-- Header -->
        <div
          class="bg-gradient-to-r from-blue-600 to-blue-700 p-6 text-white relative overflow-hidden"
        >
          <div class="flex items-center justify-between relative">
            <div class="flex items-center space-x-3">
              <!-- Updated App Icon -->
              <div class="relative">
                <img
                  src="assets/weather_wardrobe_icon.png"
                  alt="Weather Wardrobe"
                  class="app-icon"
                />
              </div>

              <div>
                <h1 class="text-2xl font-bold tracking-wide">
                  Weather Wardrobe
                </h1>
                <p class="text-blue-100 text-sm" id="welcomeText">
                  Smart clothing for any weather
                </p>
              </div>
            </div>

            <button
              onclick="toggleProfile()"
              class="p-3 bg-white bg-opacity-20 rounded-xl hover:bg-opacity-30 transition-all duration-200 backdrop-blur-sm"
              id="profileBtn"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                />
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                />
              </svg>
            </button>
          </div>
        </div>

        <!-- Profile Setup -->
        <div
          id="profileSection"
          class="hidden p-6 border-b border-gray-200 bg-gray-50"
        >
          <h3 class="text-lg font-semibold mb-4">
            Personalize Your Experience
          </h3>

          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Your Name</label
              >
              <input
                type="text"
                id="userName"
                placeholder="Enter your name"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Country</label
              >
              <select
                id="countrySelect"
                onchange="setCountry(this.value)"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="US">United States</option>
                <option value="CA">Canada</option>
                <option value="GB">United Kingdom</option>
                <option value="AU">Australia</option>
                <option value="DE">Germany</option>
                <option value="FR">France</option>
                <option value="IT">Italy</option>
                <option value="ES">Spain</option>
                <option value="NL">Netherlands</option>
                <option value="JP">Japan</option>
                <option value="IN">India</option>
                <option value="BR">Brazil</option>
                <option value="MX">Mexico</option>
                <option value="AR">Argentina</option>
                <option value="ZA">South Africa</option>
                <option value="">Other</option>
              </select>
            </div>

            <div id="stateProvinceSection" class="hidden">
              <label
                class="block text-sm font-medium text-gray-700 mb-2"
                id="stateProvinceLabel"
                >State</label
              >
              <select
                id="stateProvinceSelect"
                onchange="setStateProvince(this.value)"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="">Select state...</option>
                <!-- US States -->
                <option value="AL" data-country="US">Alabama</option>
                <option value="AK" data-country="US">Alaska</option>
                <option value="AZ" data-country="US">Arizona</option>
                <option value="AR" data-country="US">Arkansas</option>
                <option value="CA" data-country="US">California</option>
                <option value="CO" data-country="US">Colorado</option>
                <option value="CT" data-country="US">Connecticut</option>
                <option value="DE" data-country="US">Delaware</option>
                <option value="FL" data-country="US">Florida</option>
                <option value="GA" data-country="US">Georgia</option>
                <option value="HI" data-country="US">Hawaii</option>
                <option value="ID" data-country="US">Idaho</option>
                <option value="IL" data-country="US">Illinois</option>
                <option value="IN" data-country="US">Indiana</option>
                <option value="IA" data-country="US">Iowa</option>
                <option value="KS" data-country="US">Kansas</option>
                <option value="KY" data-country="US">Kentucky</option>
                <option value="LA" data-country="US">Louisiana</option>
                <option value="ME" data-country="US">Maine</option>
                <option value="MD" data-country="US">Maryland</option>
                <option value="MA" data-country="US">Massachusetts</option>
                <option value="MI" data-country="US">Michigan</option>
                <option value="MN" data-country="US">Minnesota</option>
                <option value="MS" data-country="US">Mississippi</option>
                <option value="MO" data-country="US">Missouri</option>
                <option value="MT" data-country="US">Montana</option>
                <option value="NE" data-country="US">Nebraska</option>
                <option value="NV" data-country="US">Nevada</option>
                <option value="NH" data-country="US">New Hampshire</option>
                <option value="NJ" data-country="US">New Jersey</option>
                <option value="NM" data-country="US">New Mexico</option>
                <option value="NY" data-country="US">New York</option>
                <option value="NC" data-country="US">North Carolina</option>
                <option value="ND" data-country="US">North Dakota</option>
                <option value="OH" data-country="US">Ohio</option>
                <option value="OK" data-country="US">Oklahoma</option>
                <option value="OR" data-country="US">Oregon</option>
                <option value="PA" data-country="US">Pennsylvania</option>
                <option value="RI" data-country="US">Rhode Island</option>
                <option value="SC" data-country="US">South Carolina</option>
                <option value="SD" data-country="US">South Dakota</option>
                <option value="TN" data-country="US">Tennessee</option>
                <option value="TX" data-country="US">Texas</option>
                <option value="UT" data-country="US">Utah</option>
                <option value="VT" data-country="US">Vermont</option>
                <option value="VA" data-country="US">Virginia</option>
                <option value="WA" data-country="US">Washington</option>
                <option value="WV" data-country="US">West Virginia</option>
                <option value="WI" data-country="US">Wisconsin</option>
                <option value="WY" data-country="US">Wyoming</option>
                <option value="DC" data-country="US">
                  District of Columbia
                </option>
                <!-- Canadian Provinces -->
                <option value="AB" data-country="CA">Alberta</option>
                <option value="BC" data-country="CA">British Columbia</option>
                <option value="MB" data-country="CA">Manitoba</option>
                <option value="NB" data-country="CA">New Brunswick</option>
                <option value="NL" data-country="CA">
                  Newfoundland and Labrador
                </option>
                <option value="NS" data-country="CA">Nova Scotia</option>
                <option value="ON" data-country="CA">Ontario</option>
                <option value="PE" data-country="CA">
                  Prince Edward Island
                </option>
                <option value="QC" data-country="CA">Quebec</option>
                <option value="SK" data-country="CA">Saskatchewan</option>
                <option value="NT" data-country="CA">
                  Northwest Territories
                </option>
                <option value="NU" data-country="CA">Nunavut</option>
                <option value="YT" data-country="CA">Yukon</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Temperature Preference</label
              >
              <div class="grid grid-cols-3 gap-2" id="tempPrefs">
                <button
                  onclick="setTempPref('runs-cold')"
                  class="temp-btn p-3 text-xs border rounded-lg transition-all bg-white border-gray-300 text-gray-700 hover:border-blue-300"
                  data-value="runs-cold"
                >
                  <div class="font-medium">I Run Cold</div>
                  <div class="text-gray-500">Need warmer clothes</div>
                </button>
                <button
                  onclick="setTempPref('average')"
                  class="temp-btn p-3 text-xs border rounded-lg transition-all bg-blue-100 border-blue-500 text-blue-700"
                  data-value="average"
                >
                  <div class="font-medium">Average</div>
                  <div class="text-gray-500">Standard comfort</div>
                </button>
                <button
                  onclick="setTempPref('runs-hot')"
                  class="temp-btn p-3 text-xs border rounded-lg transition-all bg-white border-gray-300 text-gray-700 hover:border-blue-300"
                  data-value="runs-hot"
                >
                  <div class="font-medium">I Run Hot</div>
                  <div class="text-gray-500">Need lighter clothes</div>
                </button>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Activity Level</label
              >
              <div class="grid grid-cols-3 gap-2" id="activityPrefs">
                <button
                  onclick="setActivityLevel('sedentary')"
                  class="activity-btn p-3 text-xs border rounded-lg transition-all bg-white border-gray-300 text-gray-700 hover:border-blue-300"
                  data-value="sedentary"
                >
                  <div class="font-medium">Sedentary</div>
                  <div class="text-gray-500">Office/desk work</div>
                </button>
                <button
                  onclick="setActivityLevel('moderate')"
                  class="activity-btn p-3 text-xs border rounded-lg transition-all bg-blue-100 border-blue-500 text-blue-700"
                  data-value="moderate"
                >
                  <div class="font-medium">Moderate</div>
                  <div class="text-gray-500">Some movement</div>
                </button>
                <button
                  onclick="setActivityLevel('active')"
                  class="activity-btn p-3 text-xs border rounded-lg transition-all bg-white border-gray-300 text-gray-700 hover:border-blue-300"
                  data-value="active"
                >
                  <div class="font-medium">Very Active</div>
                  <div class="text-gray-500">Physical work</div>
                </button>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Style Preference</label
              >
              <div class="grid grid-cols-2 gap-2" id="stylePrefs">
                <button
                  onclick="setStylePref('casual')"
                  class="style-btn p-3 text-xs border rounded-lg transition-all bg-blue-100 border-blue-500 text-blue-700"
                  data-value="casual"
                >
                  <div class="font-medium">Casual</div>
                  <div class="text-gray-500">Comfort focused</div>
                </button>
                <button
                  onclick="setStylePref('professional')"
                  class="style-btn p-3 text-xs border rounded-lg transition-all bg-white border-gray-300 text-gray-700 hover:border-blue-300"
                  data-value="professional"
                >
                  <div class="font-medium">Professional</div>
                  <div class="text-gray-500">Business attire</div>
                </button>
                <button
                  onclick="setStylePref('sporty')"
                  class="style-btn p-3 text-xs border rounded-lg transition-all bg-white border-gray-300 text-gray-700 hover:border-blue-300"
                  data-value="sporty"
                >
                  <div class="font-medium">Athletic</div>
                  <div class="text-gray-500">Active wear</div>
                </button>
                <button
                  onclick="setStylePref('fashion')"
                  class="style-btn p-3 text-xs border rounded-lg transition-all bg-white border-gray-300 text-gray-700 hover:border-blue-300"
                  data-value="fashion"
                >
                  <div class="font-medium">Fashion-Forward</div>
                  <div class="text-gray-500">Trend conscious</div>
                </button>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Work Environment</label
              >
              <div class="grid grid-cols-2 gap-2" id="workPrefs">
                <button
                  onclick="setWorkEnv('indoor')"
                  class="work-btn p-3 text-xs border rounded-lg transition-all bg-blue-100 border-blue-500 text-blue-700"
                  data-value="indoor"
                >
                  <div class="font-medium">Indoor Office</div>
                  <div class="text-gray-500">Climate controlled</div>
                </button>
                <button
                  onclick="setWorkEnv('outdoor')"
                  class="work-btn p-3 text-xs border rounded-lg transition-all bg-white border-gray-300 text-gray-700 hover:border-blue-300"
                  data-value="outdoor"
                >
                  <div class="font-medium">Outdoor Work</div>
                  <div class="text-gray-500">Weather exposed</div>
                </button>
                <button
                  onclick="setWorkEnv('mixed')"
                  class="work-btn p-3 text-xs border rounded-lg transition-all bg-white border-gray-300 text-gray-700 hover:border-blue-300"
                  data-value="mixed"
                >
                  <div class="font-medium">Mixed</div>
                  <div class="text-gray-500">Indoor + outdoor</div>
                </button>
                <button
                  onclick="setWorkEnv('home')"
                  class="work-btn p-3 text-xs border rounded-lg transition-all bg-white border-gray-300 text-gray-700 hover:border-blue-300"
                  data-value="home"
                >
                  <div class="font-medium">Work from Home</div>
                  <div class="text-gray-500">Home comfort</div>
                </button>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Special Considerations</label
              >
              <div class="grid grid-cols-1 gap-2" id="specialPrefs">
                <label
                  class="flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50"
                >
                  <input
                    type="checkbox"
                    class="special-checkbox"
                    value="natural-fabrics"
                    onchange="toggleSpecialConsideration('natural-fabrics')"
                  />
                  <span class="text-sm"
                    >Prefer natural fabrics (cotton, wool, linen)</span
                  >
                </label>
                <label
                  class="flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50"
                >
                  <input
                    type="checkbox"
                    class="special-checkbox"
                    value="easy-care"
                    onchange="toggleSpecialConsideration('easy-care')"
                  />
                  <span class="text-sm"
                    >Need easy-care/wrinkle-free materials</span
                  >
                </label>
                <label
                  class="flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50"
                >
                  <input
                    type="checkbox"
                    class="special-checkbox"
                    value="loose-fit"
                    onchange="toggleSpecialConsideration('loose-fit')"
                  />
                  <span class="text-sm">Prefer loose-fitting clothes</span>
                </label>
                <label
                  class="flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50"
                >
                  <input
                    type="checkbox"
                    class="special-checkbox"
                    value="layers"
                    onchange="toggleSpecialConsideration('layers')"
                  />
                  <span class="text-sm">Love layering options</span>
                </label>
              </div>
            </div>

            <button
              onclick="saveProfile()"
              class="w-full mt-4 bg-gradient-to-r from-green-600 to-green-700 text-white py-2 px-4 rounded-lg font-medium hover:from-green-700 hover:to-green-800 transition-all"
            >
              Save Preferences
            </button>
          </div>
        </div>

        <!-- Location Input -->
        <div class="p-6">
          <!-- Saved Location Display -->
          <div id="savedLocationDiv" class="hidden mb-6">
            <div
              class="flex items-center justify-between bg-blue-50 rounded-xl p-4 border border-blue-200"
            >
              <div class="flex items-center space-x-3">
                <svg
                  class="w-5 h-5 text-blue-600"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                  />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                  />
                </svg>
                <div>
                  <p class="text-sm text-blue-600 font-medium">Your Location</p>
                  <p
                    class="text-blue-800 font-semibold"
                    id="savedLocationText"
                  ></p>
                </div>
              </div>
              <button
                onclick="editLocation()"
                class="p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                  />
                </svg>
              </button>
            </div>

            <button
              onclick="getWeather()"
              class="w-full mt-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 px-6 rounded-xl font-semibold hover:from-blue-700 hover:to-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200"
              id="quickWeatherBtn"
            >
              Get Today's Clothing Advice
            </button>
          </div>

          <!-- Location Input Form -->
          <div id="locationInputDiv" class="mb-6">
            <div class="relative">
              <svg
                class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                />
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                />
              </svg>
              <input
                type="text"
                id="locationInput"
                placeholder="Enter city, state, or zip code"
                class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
              />
            </div>

            <button
              onclick="getWeather()"
              class="w-full mt-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 px-6 rounded-xl font-semibold hover:from-blue-700 hover:to-blue-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200"
              id="getWeatherBtn"
            >
              Get Clothing Advice
            </button>
          </div>

          <!-- Error Display -->
          <div
            id="errorDiv"
            class="hidden bg-red-50 border border-red-200 rounded-xl p-4 mb-6"
          >
            <p class="text-red-700 text-sm" id="errorText"></p>
          </div>

          <!-- Weather Results -->
          <div id="weatherResults" class="hidden space-y-6">
            <!-- Weather Info -->
            <div
              class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-100"
            >
              <div class="flex items-start justify-between mb-6">
                <div class="flex-1">
                  <h2
                    class="text-lg font-medium text-gray-700 mb-1"
                    id="weatherLocation"
                  ></h2>
                  <div class="flex items-baseline space-x-1 mb-2">
                    <span
                      class="text-5xl font-bold text-blue-700"
                      id="weatherTemp"
                    ></span>
                  </div>
                  <p
                    class="text-lg font-medium text-gray-600 capitalize"
                    id="weatherCondition"
                  ></p>
                </div>
                <div class="text-right ml-4" id="weatherIcon"></div>
              </div>

              <div class="grid grid-cols-3 gap-6 pt-4 border-t border-blue-200">
                <div class="text-center">
                  <div class="flex justify-center mb-2">
                    <svg
                      class="w-6 h-6 text-orange-500"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                      />
                    </svg>
                  </div>
                  <p
                    class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1"
                  >
                    Feels like
                  </p>
                  <p class="text-lg font-bold text-gray-800" id="feelsLike"></p>
                </div>
                <div class="text-center">
                  <div class="flex justify-center mb-2">
                    <svg
                      class="w-6 h-6 text-blue-500"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                      />
                    </svg>
                  </div>
                  <p
                    class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1"
                  >
                    Humidity
                  </p>
                  <p class="text-lg font-bold text-gray-800" id="humidity"></p>
                </div>
                <div class="text-center">
                  <div class="flex justify-center mb-2">
                    <svg
                      class="w-6 h-6 text-gray-600"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h8m-9-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                      />
                    </svg>
                  </div>
                  <p
                    class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1"
                  >
                    Wind
                  </p>
                  <p class="text-lg font-bold text-gray-800" id="windSpeed"></p>
                </div>
              </div>

              <!-- Today's Forecast Section -->
              <div id="todaysForecast" class="hidden"></div>
            </div>

            <!-- Clothing Recommendation -->
            <div
              class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-6 border border-green-200"
            >
              <div class="flex items-center mb-4">
                <svg
                  class="w-6 h-6 text-green-700 mr-3"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                  />
                </svg>
                <h3 class="text-lg font-semibold text-green-800">
                  What to Wear
                </h3>
              </div>

              <!-- Clothing Categories -->
              <div class="space-y-4 mb-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <!-- Upper Body -->
                  <div class="bg-white bg-opacity-60 rounded-lg p-3">
                    <div class="flex items-center mb-2">
                      <svg
                        class="w-4 h-4 text-green-600 mr-2"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"
                        />
                      </svg>
                      <h4 class="font-medium text-green-800 text-sm">
                        Upper Body
                      </h4>
                    </div>
                    <p
                      class="text-green-700 text-sm"
                      id="topRecommendation"
                    ></p>
                  </div>

                  <!-- Lower Body -->
                  <div class="bg-white bg-opacity-60 rounded-lg p-3">
                    <div class="flex items-center mb-2">
                      <svg
                        class="w-4 h-4 text-green-600 mr-2"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                        />
                      </svg>
                      <h4 class="font-medium text-green-800 text-sm">
                        Lower Body
                      </h4>
                    </div>
                    <p
                      class="text-green-700 text-sm"
                      id="bottomRecommendation"
                    ></p>
                  </div>

                  <!-- Footwear -->
                  <div class="bg-white bg-opacity-60 rounded-lg p-3">
                    <div class="flex items-center mb-2">
                      <svg
                        class="w-4 h-4 text-green-600 mr-2"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3v-1m6-4V7a3 3 0 013-3h4a3 3 0 013 3v1"
                        />
                      </svg>
                      <h4 class="font-medium text-green-800 text-sm">
                        Footwear
                      </h4>
                    </div>
                    <p
                      class="text-green-700 text-sm"
                      id="footwearRecommendation"
                    ></p>
                  </div>

                  <!-- Accessories -->
                  <div class="bg-white bg-opacity-60 rounded-lg p-3">
                    <div class="flex items-center mb-2">
                      <svg
                        class="w-4 h-4 text-green-600 mr-2"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                        />
                      </svg>
                      <h4 class="font-medium text-green-800 text-sm">
                        Accessories
                      </h4>
                    </div>
                    <p
                      class="text-green-700 text-sm"
                      id="accessoriesRecommendation"
                    ></p>
                  </div>
                </div>
              </div>

              <!-- Weather-specific alerts -->
              <div
                id="weatherAlerts"
                class="hidden bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4"
              >
                <div class="flex items-start">
                  <svg
                    class="w-4 h-4 text-amber-600 mr-2 mt-0.5 flex-shrink-0"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.966-.833-2.736 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"
                    />
                  </svg>
                  <p class="text-amber-800 text-sm" id="weatherAlertText"></p>
                </div>
              </div>

              <div
                id="personalizedNote"
                class="hidden bg-white bg-opacity-70 rounded-lg p-3 text-sm"
              >
                <div class="flex items-start">
                  <svg
                    class="w-4 h-4 text-green-600 mr-2 mt-0.5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
                    />
                  </svg>
                  <div>
                    <p class="text-green-600 font-medium">
                      Personalized for you!
                    </p>
                    <p class="text-green-600">
                      Recommendations adjusted for your preferences and activity
                      level.
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Refresh Button -->
            <button
              onclick="getWeather()"
              class="w-full bg-gray-100 text-gray-700 py-3 px-6 rounded-xl font-medium hover:bg-gray-200 transition-colors duration-200"
            >
              Refresh Weather
            </button>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="text-center mt-6 text-white text-sm opacity-75">
        <p>Stay comfortable, dress smart! 🌤️</p>
      </div>
    </div>

    <script>
      // Global state
      let userProfile = {
        name: "",
        temperaturePreference: "average",
        activityLevel: "moderate",
        stylePreference: "casual",
        workEnvironment: "indoor",
        country: "US",
        stateProvince: "",
        specialConsiderations: [],
        hasLearned: false,
      };
      let savedLocation = "";
      let isShowingProfile = false;

      // Load saved data on page load
      window.addEventListener("load", function () {
        loadUserData();
        updateUI();
      });

      function loadUserData() {
        try {
          const profile = localStorage.getItem("weatherWardrobeProfile");
          if (profile) {
            userProfile = JSON.parse(profile);
          }

          const location = localStorage.getItem("weatherWardrobeLocation");
          if (location) {
            savedLocation = location;
            document.getElementById("locationInput").value = location;
          }
        } catch (e) {
          console.log("Storage not available");
        }
      }

      function updateUI() {
        // Update welcome text
        const welcomeText = document.getElementById("welcomeText");
        if (userProfile.name) {
          welcomeText.textContent = `Hello, ${userProfile.name}!`;
        }

        // Update location display
        if (savedLocation) {
          document.getElementById("savedLocationText").textContent =
            savedLocation;
          document
            .getElementById("savedLocationDiv")
            .classList.remove("hidden");
          document.getElementById("locationInputDiv").classList.add("hidden");
        } else {
          document.getElementById("savedLocationDiv").classList.add("hidden");
          document
            .getElementById("locationInputDiv")
            .classList.remove("hidden");
        }

        // Update profile form
        if (userProfile.name) {
          document.getElementById("userName").value = userProfile.name;
        }

        // Update country selection
        document.getElementById("countrySelect").value = userProfile.country;
        document.getElementById("stateProvinceSelect").value =
          userProfile.stateProvince;
        updateStateProvinceVisibility();
        updateLocationPlaceholder();

        // Update temperature preference buttons
        document.querySelectorAll(".temp-btn").forEach((btn) => {
          const value = btn.getAttribute("data-value");
          if (value === userProfile.temperaturePreference) {
            btn.className =
              "temp-btn p-3 text-xs border rounded-lg transition-all bg-blue-100 border-blue-500 text-blue-700";
          } else {
            btn.className =
              "temp-btn p-3 text-xs border rounded-lg transition-all bg-white border-gray-300 text-gray-700 hover:border-blue-300";
          }
        });

        // Update activity level buttons
        document.querySelectorAll(".activity-btn").forEach((btn) => {
          const value = btn.getAttribute("data-value");
          if (value === userProfile.activityLevel) {
            btn.className =
              "activity-btn p-3 text-xs border rounded-lg transition-all bg-blue-100 border-blue-500 text-blue-700";
          } else {
            btn.className =
              "activity-btn p-3 text-xs border rounded-lg transition-all bg-white border-gray-300 text-gray-700 hover:border-blue-300";
          }
        });

        // Update style preference buttons
        document.querySelectorAll(".style-btn").forEach((btn) => {
          const value = btn.getAttribute("data-value");
          if (value === userProfile.stylePreference) {
            btn.className =
              "style-btn p-3 text-xs border rounded-lg transition-all bg-blue-100 border-blue-500 text-blue-700";
          } else {
            btn.className =
              "style-btn p-3 text-xs border rounded-lg transition-all bg-white border-gray-300 text-gray-700 hover:border-blue-300";
          }
        });

        // Update work environment buttons
        document.querySelectorAll(".work-btn").forEach((btn) => {
          const value = btn.getAttribute("data-value");
          if (value === userProfile.workEnvironment) {
            btn.className =
              "work-btn p-3 text-xs border rounded-lg transition-all bg-blue-100 border-blue-500 text-blue-700";
          } else {
            btn.className =
              "work-btn p-3 text-xs border rounded-lg transition-all bg-white border-gray-300 text-gray-700 hover:border-blue-300";
          }
        });

        // Update special considerations checkboxes
        document.querySelectorAll(".special-checkbox").forEach((checkbox) => {
          const value = checkbox.value;
          checkbox.checked = userProfile.specialConsiderations.includes(value);
        });
      }

      function toggleProfile() {
        const profileSection = document.getElementById("profileSection");
        isShowingProfile = !isShowingProfile;

        if (isShowingProfile) {
          profileSection.classList.remove("hidden");
        } else {
          profileSection.classList.add("hidden");
        }
      }

      function setTempPref(pref) {
        userProfile.temperaturePreference = pref;
        updateUI();
      }

      function setActivityLevel(level) {
        userProfile.activityLevel = level;
        updateUI();
      }

      function setStylePref(style) {
        userProfile.stylePreference = style;
        updateUI();
      }

      function setWorkEnv(env) {
        userProfile.workEnvironment = env;
        updateUI();
      }

      function setCountry(country) {
        userProfile.country = country;
        userProfile.stateProvince = ""; // Reset state when country changes
        updateStateProvinceVisibility();
        updateLocationPlaceholder();
      }

      function setStateProvince(stateProvince) {
        userProfile.stateProvince = stateProvince;
        updateLocationPlaceholder();
      }

      function updateStateProvinceVisibility() {
        const stateSection = document.getElementById("stateProvinceSection");
        const stateLabel = document.getElementById("stateProvinceLabel");
        const stateSelect = document.getElementById("stateProvinceSelect");

        if (userProfile.country === "US") {
          stateSection.classList.remove("hidden");
          stateLabel.textContent = "State";
          // Show only US states
          Array.from(stateSelect.options).forEach((option) => {
            if (option.value === "") {
              option.style.display = "block";
              option.textContent = "Select state...";
            } else if (option.dataset.country === "US") {
              option.style.display = "block";
            } else {
              option.style.display = "none";
            }
          });
        } else if (userProfile.country === "CA") {
          stateSection.classList.remove("hidden");
          stateLabel.textContent = "Province";
          // Show only Canadian provinces
          Array.from(stateSelect.options).forEach((option) => {
            if (option.value === "") {
              option.style.display = "block";
              option.textContent = "Select province...";
            } else if (option.dataset.country === "CA") {
              option.style.display = "block";
            } else {
              option.style.display = "none";
            }
          });
        } else {
          stateSection.classList.add("hidden");
        }

        // Reset selection when changing country
        stateSelect.value = userProfile.stateProvince;
      }

      function updateLocationPlaceholder() {
        const locationInput = document.getElementById("locationInput");
        if (userProfile.country === "US") {
          if (userProfile.stateProvince) {
            locationInput.placeholder = "Enter city or zip code";
          } else {
            locationInput.placeholder = "Enter city, state, or zip code";
          }
        } else if (userProfile.country === "CA") {
          if (userProfile.stateProvince) {
            locationInput.placeholder = "Enter city or postal code";
          } else {
            locationInput.placeholder = "Enter city, province, or postal code";
          }
        } else if (userProfile.country === "GB") {
          locationInput.placeholder = "Enter city or postcode";
        } else if (userProfile.country === "") {
          locationInput.placeholder =
            "Enter city name with country (e.g., 'Paris, FR')";
        } else {
          locationInput.placeholder = "Enter city name";
        }
      }

      function formatLocationDisplay(cityName, countryCode) {
        // Capitalize city name properly
        const formattedCity = cityName
          .split(" ")
          .map(
            (word) =>
              word.charAt(0).toUpperCase() + word.slice(1).toLowerCase(),
          )
          .join(" ");

        // Map country codes to state abbreviations for US/Canada
        if (countryCode === "US" && userProfile.stateProvince) {
          return `${formattedCity}, ${userProfile.stateProvince}`;
        } else if (countryCode === "CA" && userProfile.stateProvince) {
          return `${formattedCity}, ${userProfile.stateProvince}`;
        } else if (countryCode === "US") {
          // Show full country name if no state is set
          return `${formattedCity}, United States`;
        } else if (countryCode === "CA") {
          return `${formattedCity}, Canada`;
        } else {
          // For other countries, show the country code or name
          const countryNames = {
            GB: "United Kingdom",
            AU: "Australia",
            DE: "Germany",
            FR: "France",
            IT: "Italy",
            ES: "Spain",
            NL: "Netherlands",
            JP: "Japan",
            IN: "India",
            BR: "Brazil",
            MX: "Mexico",
            AR: "Argentina",
            ZA: "South Africa",
          };
          const countryName = countryNames[countryCode] || countryCode;
          return `${formattedCity}, ${countryName}`;
        }
      }

      function toggleSpecialConsideration(consideration) {
        const index = userProfile.specialConsiderations.indexOf(consideration);
        if (index > -1) {
          userProfile.specialConsiderations.splice(index, 1);
        } else {
          userProfile.specialConsiderations.push(consideration);
        }
      }

      function saveProfile() {
        const name = document.getElementById("userName").value;
        userProfile.name = name;
        userProfile.hasLearned = true;

        try {
          localStorage.setItem(
            "weatherWardrobeProfile",
            JSON.stringify(userProfile),
          );
        } catch (e) {
          console.log("Cannot save to storage");
        }

        toggleProfile();
        updateUI();
      }

      function editLocation() {
        // Clear saved location temporarily to force using input field
        savedLocation = "";

        document.getElementById("savedLocationDiv").classList.add("hidden");
        document.getElementById("locationInputDiv").classList.remove("hidden");

        const locationInput = document.getElementById("locationInput");
        locationInput.focus();
        locationInput.select(); // Select all text for easy replacement

        console.log("Edit mode activated, savedLocation cleared"); // Debug log
      }

      function getSimpleForecast(currentData) {
        // Create a simple forecast based on current weather when detailed forecast fails
        const currentTemp = Math.round(currentData.main.temp);
        const alerts = [];

        // Generate some basic forecast info
        const high = currentTemp + Math.floor(Math.random() * 10) + 2; // 2-12 degrees higher
        const low = currentTemp - Math.floor(Math.random() * 15) - 5; // 5-20 degrees lower

        // Add some basic alerts based on current conditions
        if (currentData.weather[0].main.toLowerCase().includes("thunder")) {
          alerts.push(
            "Thunderstorms possible - bring an umbrella and avoid outdoor activities!",
          );
        }
        if (currentData.wind?.speed > 10) {
          alerts.push(
            "Windy conditions continuing - secure clothing and accessories!",
          );
        }
        if (high - currentTemp > 8) {
          alerts.push(
            `Temperature may rise to ${high}°F later - dress in layers!`,
          );
        }

        return {
          high,
          low,
          afternoon: currentData.weather[0].main,
          evening: currentData.weather[0].main,
          alerts:
            alerts.length > 0
              ? alerts
              : [`High: ${high}°F, Low: ${low}°F expected today`],
        };
      }

      function getTodaysForecast(forecastData) {
        if (
          !forecastData ||
          !forecastData.list ||
          forecastData.list.length === 0
        ) {
          console.log("No forecast data available"); // Debug log
          return null;
        }

        const today = new Date();
        const todayStr = today.toISOString().split("T")[0]; // YYYY-MM-DD format

        // Filter today's forecast entries (3-hour intervals)
        const todaysEntries = forecastData.list.filter((entry) => {
          const entryDate = new Date(entry.dt * 1000)
            .toISOString()
            .split("T")[0];
          return entryDate === todayStr;
        });

        console.log("Today entries found:", todaysEntries.length); // Debug log

        if (todaysEntries.length === 0) {
          // If no entries for today, use tomorrow's data
          const tomorrow = new Date(today);
          tomorrow.setDate(tomorrow.getDate() + 1);
          const tomorrowStr = tomorrow.toISOString().split("T")[0];

          const tomorrowEntries = forecastData.list
            .filter((entry) => {
              const entryDate = new Date(entry.dt * 1000)
                .toISOString()
                .split("T")[0];
              return entryDate === tomorrowStr;
            })
            .slice(0, 3); // Just first 3 entries of tomorrow

          if (tomorrowEntries.length === 0) {
            return null;
          }

          const temps = tomorrowEntries.map((entry) => entry.main.temp);
          return {
            high: Math.round(Math.max(...temps)),
            low: Math.round(Math.min(...temps)),
            afternoon: tomorrowEntries[0]?.weather[0].main || "Unknown",
            evening: tomorrowEntries[1]?.weather[0].main || "Unknown",
            alerts: ["Showing tomorrow's forecast"],
          };
        }

        // Find high and low temps for today
        const temps = todaysEntries.map((entry) => entry.main.temp);
        const high = Math.round(Math.max(...temps));
        const low = Math.round(Math.min(...temps));

        // Get afternoon and evening conditions
        const currentHour = today.getHours();
        const afternoonEntry = todaysEntries.find((entry) => {
          const hour = new Date(entry.dt * 1000).getHours();
          return hour >= 14 && hour <= 17; // 2 PM - 5 PM
        });
        const eveningEntry = todaysEntries.find((entry) => {
          const hour = new Date(entry.dt * 1000).getHours();
          return hour >= 18 && hour <= 21; // 6 PM - 9 PM
        });

        // Generate alerts based on forecast
        const alerts = [];

        // Check for rain/snow later
        const laterEntries = todaysEntries.filter((entry) => {
          const hour = new Date(entry.dt * 1000).getHours();
          return hour > currentHour;
        });

        const rainLater = laterEntries.some(
          (entry) =>
            entry.weather[0].main.toLowerCase().includes("rain") ||
            entry.weather[0].main.toLowerCase().includes("drizzle"),
        );
        const snowLater = laterEntries.some((entry) =>
          entry.weather[0].main.toLowerCase().includes("snow"),
        );
        const windyLater = laterEntries.some(
          (entry) => (entry.wind?.speed || 0) > 15,
        );

        if (rainLater)
          alerts.push(
            "Rain expected later today - consider bringing an umbrella!",
          );
        if (snowLater)
          alerts.push("Snow expected later - pack extra warm layers!");
        if (windyLater)
          alerts.push("Getting windier later - consider a windbreaker!");

        // Temperature change alerts
        const currentTemp = Math.round(todaysEntries[0]?.main.temp || 0);
        if (high - currentTemp > 10) {
          alerts.push(`Warming up significantly - high of ${high}°F expected!`);
        }
        if (currentTemp - low > 10 && currentHour < 18) {
          alerts.push(`Cooling down later - low of ${low}°F tonight!`);
        }

        // If no specific alerts, add a general one
        if (alerts.length === 0) {
          alerts.push(`High: ${high}°F, Low: ${low}°F expected today`);
        }

        return {
          high,
          low,
          afternoon: afternoonEntry?.weather[0].main || "Similar conditions",
          evening: eveningEntry?.weather[0].main || "Similar conditions",
          alerts,
        };
      }

      async function getWeather() {
        console.log("getWeather function called!"); // Debug log
        const locationInput = document.getElementById("locationInput");
        const inputValue = locationInput.value.trim();

        console.log("getWeather called with input:", inputValue); // Debug log
        console.log("savedLocation:", savedLocation); // Debug log

        // Use input field value if it exists and we're not in saved mode
        const location = inputValue || savedLocation;

        if (!location) {
          showError("Please enter a location");
          return;
        }

        // Enhance location with state/province and country for better API results
        let enhancedLocation = location;
        if (userProfile.country && userProfile.country !== "") {
          // If it's just a city name (no comma), add state and country
          if (!location.includes(",") && !location.match(/^\d{5}(-\d{4})?$/)) {
            if (
              userProfile.stateProvince &&
              (userProfile.country === "US" || userProfile.country === "CA")
            ) {
              enhancedLocation = `${location},${userProfile.stateProvince},${userProfile.country}`;
            } else {
              enhancedLocation = `${location},${userProfile.country}`;
            }
          }
        }

        console.log("Final location to search:", enhancedLocation); // Debug log

        // Show loading state
        const button =
          document.getElementById("getWeatherBtn") ||
          document.getElementById("quickWeatherBtn");
        if (button) {
          const originalText = button.textContent;
          button.innerHTML = '<div class="spinner mx-auto"></div>';
          button.disabled = true;
        }

        hideError();

        try {
          // Use secure serverless function instead of direct API calls
          console.log("Using secure API for:", location); // Debug log

          // Get current weather through secure API
          const currentResponse = await fetch(
            `/api/weather?location=${encodeURIComponent(enhancedLocation)}&type=current`,
          );

          const currentData = await currentResponse.json();
          console.log("Current weather from secure API:", currentData); // Debug log

          if (currentResponse.ok) {
            // Get today's forecast through secure API
            let forecastData = null;
            try {
              const forecastResponse = await fetch(
                `/api/weather?location=${encodeURIComponent(enhancedLocation)}&type=forecast`,
              );

              if (forecastResponse.ok) {
                forecastData = await forecastResponse.json();
                console.log(
                  "Forecast data received from secure API:",
                  forecastData,
                ); // Debug log
              } else {
                console.log("Forecast API failed, continuing without forecast"); // Debug log
              }
            } catch (forecastError) {
              console.log("Forecast API error:", forecastError); // Debug log
            }

            // Process today's forecast
            const todaysForecast = forecastData
              ? getTodaysForecast(forecastData)
              : getSimpleForecast(currentData);
            console.log("Processed forecast:", todaysForecast); // Debug log

            // Use API-resolved city name (e.g., "08077" becomes "Cinnaminson")
            const weatherData = {
              location: formatLocationDisplay(
                currentData.name,
                currentData.sys.country,
              ),
              temperature: Math.round(currentData.main.temp),
              condition: currentData.weather[0].main,
              humidity: currentData.main.humidity,
              windSpeed: Math.round(currentData.wind?.speed || 0),
              feelsLike: Math.round(currentData.main.feels_like),
              forecast: todaysForecast,
            };

            displayWeather(weatherData);

            // Save the new location
            savedLocation = location;
            try {
              localStorage.setItem("weatherWardrobeLocation", savedLocation);
            } catch (e) {
              console.log("Cannot save location");
            }
            updateUI();
          } else {
            showError(
              currentData.error ||
                'Location not found. Please try again with a different format (e.g., "New York, NY" or "10001").',
            );
          }
        } catch (err) {
          console.log("Secure API call failed, using demo data:", err);

          // Demo weather data with forecast
          // Simulate zip code resolution for demo mode
          let demoLocationName = location;

          // Common NJ zip codes for testing
          const njZipCodes = {
            "08077": "Cinnaminson",
            "08075": "Delran",
            "08003": "Cherry Hill",
            "07302": "Jersey City",
            "07030": "Hoboken",
            "07102": "Newark",
            "08701": "Lakewood",
            "08540": "Princeton",
            "07748": "Middletown",
            "08901": "New Brunswick",
            "07960": "Morristown",
          };

          // Common CA zip codes for testing
          const caZipCodes = {
            90210: "Beverly Hills",
            94102: "San Francisco",
            90401: "Santa Monica",
            92101: "San Diego",
            95014: "Cupertino",
            94301: "Palo Alto",
            90405: "Santa Monica",
            91601: "North Hollywood",
            92037: "La Jolla",
            94107: "San Francisco",
          };

          // Check if input is a zip code and resolve it
          if (location.match(/^\d{5}(-\d{4})?$/)) {
            if (
              userProfile.country === "US" &&
              userProfile.stateProvince === "NJ" &&
              njZipCodes[location]
            ) {
              demoLocationName = njZipCodes[location];
            } else if (
              userProfile.country === "US" &&
              userProfile.stateProvince === "CA" &&
              caZipCodes[location]
            ) {
              demoLocationName = caZipCodes[location];
            } else {
              // Generic city name for unknown zip codes
              demoLocationName = "Demo City";
            }
          }

          const demoWeather = {
            location: formatLocationDisplay(
              demoLocationName,
              userProfile.country || "US",
            ),
            temperature: Math.floor(Math.random() * 50) + 30,
            condition: ["Clear", "Clouds", "Rain", "Snow"][
              Math.floor(Math.random() * 4)
            ],
            humidity: Math.floor(Math.random() * 40) + 40,
            windSpeed: Math.floor(Math.random() * 15) + 2,
            feelsLike: Math.floor(Math.random() * 50) + 30,
            forecast: {
              high: Math.floor(Math.random() * 20) + 70,
              low: Math.floor(Math.random() * 20) + 40,
              afternoon: ["Sunny", "Cloudy", "Light Rain"][
                Math.floor(Math.random() * 3)
              ],
              evening: ["Clear", "Partly Cloudy", "Overcast"][
                Math.floor(Math.random() * 3)
              ],
              alerts: ["Demo forecast data - showing sample alerts"],
            },
          };

          displayWeather(demoWeather);

          // Save location even for demo
          savedLocation = location;
          try {
            localStorage.setItem("weatherWardrobeLocation", savedLocation);
          } catch (e) {
            console.log("Cannot save location");
          }
          updateUI();
        } finally {
          // Reset button
          if (button) {
            button.textContent =
              button.id === "getWeatherBtn"
                ? "Get Clothing Advice"
                : "Get Today's Clothing Advice";
            button.disabled = false;
          }
        }
      }

      function displayWeather(weather) {
        // Update weather info
        document.getElementById("weatherLocation").textContent =
          weather.location;
        document.getElementById("weatherTemp").textContent =
          weather.temperature + "°F";
        document.getElementById("weatherCondition").textContent =
          weather.condition;
        document.getElementById("feelsLike").textContent =
          weather.feelsLike + "°F";
        document.getElementById("humidity").textContent =
          weather.humidity + "%";
        document.getElementById("windSpeed").textContent =
          weather.windSpeed + " mph";

        // Update weather icon
        const iconContainer = document.getElementById("weatherIcon");
        iconContainer.innerHTML = getWeatherIcon(weather.condition);

        // Update today's forecast if available
        const forecastContainer = document.getElementById("todaysForecast");
        if (weather.forecast) {
          console.log("Displaying forecast:", weather.forecast); // Debug log
          let forecastHTML = `
                    <div class="bg-blue-50 rounded-xl p-4 mt-4">
                        <h4 class="font-semibold text-blue-800 mb-2">📅 Today's Forecast</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm mb-3">
                            <div class="text-center">
                                <p class="text-blue-600">High</p>
                                <p class="font-bold text-blue-800">${weather.forecast.high}°F</p>
                            </div>
                            <div class="text-center">
                                <p class="text-blue-600">Low</p>
                                <p class="font-bold text-blue-800">${weather.forecast.low}°F</p>
                            </div>
                        </div>
                `;

          if (weather.forecast.alerts && weather.forecast.alerts.length > 0) {
            forecastHTML += '<div class="space-y-1">';
            weather.forecast.alerts.forEach((alert) => {
              forecastHTML += `<p class="text-blue-700 text-xs">⚠️ ${alert}</p>`;
            });
            forecastHTML += "</div>";
          }

          forecastHTML += "</div>";
          forecastContainer.innerHTML = forecastHTML;
          forecastContainer.classList.remove("hidden");
        } else {
          console.log("No forecast data to display"); // Debug log
          forecastContainer.classList.add("hidden");
        }

        // Update clothing advice with detailed categorized recommendations
        const advice = getClothingRecommendation(
          weather.temperature,
          weather.condition,
          weather.forecast,
        );

        // The new system populates individual categories automatically

        // Show personalized note if applicable
        if (userProfile.hasLearned) {
          document
            .getElementById("personalizedNote")
            .classList.remove("hidden");
        }

        // Show results
        document.getElementById("weatherResults").classList.remove("hidden");
      }

      function getWeatherIcon(condition) {
        const lowerCondition = condition.toLowerCase();
        if (
          lowerCondition.includes("rain") ||
          lowerCondition.includes("drizzle")
        ) {
          return `<svg class="weather-icon text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M8 19v2m8-2v2m-4-3v2m-4-5v2"/>
                </svg>`;
        } else if (lowerCondition.includes("cloud")) {
          return `<svg class="weather-icon text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
                </svg>`;
        } else {
          return `<svg class="weather-icon text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>`;
        }
      }

      function getClothingRecommendation(temp, condition, forecast) {
        const lowerCondition = condition.toLowerCase();
        let baseTemp = temp;

        // Adjust temperature based on user preferences
        if (userProfile.temperaturePreference === "runs-hot") {
          baseTemp += 10;
        } else if (userProfile.temperaturePreference === "runs-cold") {
          baseTemp -= 10;
        }

        // Adjust for activity level
        if (userProfile.activityLevel === "active") {
          baseTemp += 5; // Active people get warmer
        } else if (userProfile.activityLevel === "sedentary") {
          baseTemp -= 3; // Sedentary people might feel cooler
        }

        // Get detailed recommendations by category
        const recommendations = getDetailedClothingRecommendations(
          baseTemp,
          lowerCondition,
          forecast,
        );

        // Update each category in the UI
        const topEl = document.getElementById("topRecommendation");
        const bottomEl = document.getElementById("bottomRecommendation");
        const footwearEl = document.getElementById("footwearRecommendation");
        const accessoriesEl = document.getElementById(
          "accessoriesRecommendation",
        );
        const alertDiv = document.getElementById("weatherAlerts");
        const alertText = document.getElementById("weatherAlertText");

        console.log("Elements found:", {
          topEl: !!topEl,
          bottomEl: !!bottomEl,
          footwearEl: !!footwearEl,
          accessoriesEl: !!accessoriesEl,
          alertDiv: !!alertDiv,
          alertText: !!alertText,
        });

        if (topEl) topEl.textContent = recommendations.top;
        if (bottomEl) bottomEl.textContent = recommendations.bottom;
        if (footwearEl) footwearEl.textContent = recommendations.footwear;
        if (accessoriesEl)
          accessoriesEl.textContent = recommendations.accessories;

        // Handle weather alerts
        if (recommendations.alerts && recommendations.alerts.length > 0) {
          alertText.textContent = recommendations.alerts.join(" ");
          alertDiv.classList.remove("hidden");
        } else {
          alertDiv.classList.add("hidden");
        }

        // Return a summary for backward compatibility
        return `${recommendations.top} ${recommendations.bottom} ${recommendations.footwear}`;
      }

      function showError(message) {
        document.getElementById("errorText").textContent = message;
        document.getElementById("errorDiv").classList.remove("hidden");
      }

      function hideError() {
        document.getElementById("errorDiv").classList.add("hidden");
      }

      function getDetailedClothingRecommendations(
        baseTemp,
        condition,
        forecast,
      ) {
        const style = userProfile.stylePreference;
        const isRainy =
          condition.includes("rain") || condition.includes("drizzle");
        const isSnowy = condition.includes("snow");
        const isWindy = condition.includes("wind");

        let recommendations = {
          top: "",
          bottom: "",
          footwear: "",
          accessories: "",
          alerts: [],
        };

        // Upper Body Recommendations
        if (baseTemp >= 80) {
          if (style === "professional") {
            recommendations.top =
              "Lightweight button-down, breathable blouse, or linen shirt";
          } else if (style === "sporty") {
            recommendations.top =
              "Moisture-wicking tank top or performance t-shirt";
          } else if (style === "fashion") {
            recommendations.top =
              "Stylish crop top, trendy tank, or flowy blouse";
          } else {
            recommendations.top =
              "Light cotton t-shirt, tank top, or sleeveless top";
          }
        } else if (baseTemp >= 70) {
          if (style === "professional") {
            recommendations.top =
              "Cotton button-down, polo shirt, or lightweight blouse";
          } else if (style === "sporty") {
            recommendations.top =
              "Athletic t-shirt, performance polo, or workout top";
          } else if (style === "fashion") {
            recommendations.top =
              "Trendy t-shirt, fashion top, or lightweight cardigan";
          } else {
            recommendations.top =
              "Comfortable t-shirt, casual button-down, or light sweater";
          }
        } else if (baseTemp >= 60) {
          if (style === "professional") {
            recommendations.top =
              "Long-sleeve shirt with light blazer or cardigan";
          } else if (style === "sporty") {
            recommendations.top =
              "Long-sleeve athletic shirt or lightweight hoodie";
          } else if (style === "fashion") {
            recommendations.top =
              "Stylish sweater, fashion cardigan, or layered look";
          } else {
            recommendations.top =
              "Long-sleeve shirt, light sweater, or thin hoodie";
          }
        } else if (baseTemp >= 50) {
          if (style === "professional") {
            recommendations.top =
              "Wool sweater, thick blazer, or professional cardigan";
          } else if (style === "sporty") {
            recommendations.top =
              "Fleece jacket, thick hoodie, or athletic sweatshirt";
          } else if (style === "fashion") {
            recommendations.top =
              "Trendy sweater, oversized cardigan, or stylish jacket";
          } else {
            recommendations.top =
              "Medium-weight sweater, hoodie, or casual jacket";
          }
        } else if (baseTemp >= 40) {
          recommendations.top = "Warm sweater or fleece with insulating layers";
        } else if (baseTemp >= 30) {
          recommendations.top =
            "Heavy sweater, thermal base layer, and warm coat";
        } else {
          recommendations.top =
            "Multiple layers: thermal underwear, heavy sweater, winter coat";
        }

        // Lower Body Recommendations
        if (baseTemp >= 80) {
          if (style === "professional") {
            recommendations.bottom =
              "Lightweight dress pants, knee-length skirt, or professional shorts";
          } else if (style === "sporty") {
            recommendations.bottom =
              "Athletic shorts, performance leggings, or gym wear";
          } else if (style === "fashion") {
            recommendations.bottom =
              "High-waisted shorts, mini skirt, or trendy capris";
          } else {
            recommendations.bottom =
              "Shorts, lightweight pants, or summer dress";
          }
        } else if (baseTemp >= 70) {
          if (style === "professional") {
            recommendations.bottom =
              "Dress pants, midi skirt, or tailored trousers";
          } else if (style === "sporty") {
            recommendations.bottom = "Athletic pants, leggings, or joggers";
          } else if (style === "fashion") {
            recommendations.bottom =
              "Jeans, fashionable pants, or stylish skirt";
          } else {
            recommendations.bottom =
              "Jeans, casual pants, or comfortable skirt";
          }
        } else if (baseTemp >= 50) {
          if (style === "professional") {
            recommendations.bottom =
              "Wool pants, warm skirt with tights, or dress slacks";
          } else if (style === "sporty") {
            recommendations.bottom =
              "Thermal leggings, warm athletic pants, or fleece-lined joggers";
          } else {
            recommendations.bottom = "Jeans, warm pants, or thick leggings";
          }
        } else if (baseTemp >= 30) {
          recommendations.bottom =
            "Insulated pants, thermal leggings, or winter trousers";
        } else {
          recommendations.bottom =
            "Thermal underwear with heavy pants or insulated winter gear";
        }

        // Footwear Recommendations
        if (baseTemp >= 80) {
          if (style === "professional") {
            recommendations.footwear =
              "Breathable dress shoes, professional sandals, or loafers";
          } else if (style === "sporty") {
            recommendations.footwear =
              "Athletic shoes, running sandals, or sport slides";
          } else if (style === "fashion") {
            recommendations.footwear =
              "Stylish sandals, fashion sneakers, or trendy flats";
          } else {
            recommendations.footwear =
              "Sandals, flip-flops, or breathable sneakers";
          }
        } else if (baseTemp >= 70) {
          if (style === "professional") {
            recommendations.footwear =
              "Dress shoes, professional flats, or loafers";
          } else if (style === "sporty") {
            recommendations.footwear =
              "Sneakers, athletic shoes, or casual trainers";
          } else {
            recommendations.footwear =
              "Comfortable shoes, casual sneakers, or flats";
          }
        } else if (baseTemp >= 50) {
          if (style === "professional") {
            recommendations.footwear =
              "Closed-toe dress shoes or professional ankle boots";
          } else {
            recommendations.footwear =
              "Sneakers, boots, or warm closed-toe shoes";
          }
        } else if (baseTemp >= 30) {
          recommendations.footwear =
            "Insulated boots or warm winter shoes with good traction";
        } else {
          recommendations.footwear =
            "Waterproof winter boots with thermal insulation";
        }

        // Accessories Recommendations
        if (baseTemp >= 80) {
          recommendations.accessories = "Sunglasses, sun hat, and sunscreen";
        } else if (baseTemp >= 70) {
          recommendations.accessories =
            "Light accessories, sunglasses if sunny";
        } else if (baseTemp >= 60) {
          recommendations.accessories = "Light scarf or jacket you can remove";
        } else if (baseTemp >= 50) {
          recommendations.accessories = "Scarf, light gloves, or warm hat";
        } else if (baseTemp >= 40) {
          recommendations.accessories = "Warm scarf, gloves, and beanie or hat";
        } else if (baseTemp >= 30) {
          recommendations.accessories =
            "Insulated gloves, warm hat, thick scarf";
        } else {
          recommendations.accessories =
            "Full winter accessories: thermal gloves, warm hat, thick scarf";
        }

        // Weather-specific alerts and adjustments
        if (isRainy) {
          recommendations.alerts.push(
            "Rain expected - bring umbrella and waterproof footwear!",
          );
          if (
            recommendations.footwear.includes("sandals") ||
            recommendations.footwear.includes("flats")
          ) {
            recommendations.footwear = "Water-resistant shoes or rain boots";
          }
        }

        if (isSnowy) {
          recommendations.alerts.push(
            "Snow conditions - wear waterproof boots with good traction!",
          );
          recommendations.footwear =
            "Waterproof winter boots with anti-slip soles";
        }

        if (isWindy) {
          recommendations.alerts.push(
            "Windy conditions - secure loose clothing and accessories!",
          );
        }

        // Work environment adjustments
        if (userProfile.workEnvironment === "outdoor") {
          recommendations.alerts.push(
            "Working outdoors - choose weather-resistant materials",
          );
        }

        return recommendations;
      }

      // Allow Enter key to search - with proper event handling
      document
        .getElementById("locationInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            e.preventDefault(); // Prevent form submission/page refresh
            e.stopPropagation(); // Stop event bubbling
            getWeather();
          }
        });

      // Also prevent any form submission if the input is somehow in a form
      document
        .getElementById("locationInput")
        .addEventListener("keydown", function (e) {
          if (e.key === "Enter") {
            e.preventDefault();
            getWeather();
          }
        });
    </script>
    <!-- Secure API deployment -->
  </body>
</html>
